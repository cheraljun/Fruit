# 架构设计

## 五层架构

```
frontend/           编辑器和在线播放器（React + Vite）
backend/            用户认证和数据持久化（Express + JWT）
shared/             跨端共享（引擎 + 插件系统 + 类型）
player-standalone/  独立播放器构建器（terminal + visual-novel）
packager/           桌面版打包工具（Node.js便携版 + 启动器）
```

## 设计哲学

**成熟框架优先** - ReactFlow（节点流）、Blockly（脚本）、Vite（打包）
**粘合不重造** - 项目价值在于粘合现有框架，不重新实现轮子
**跨端共享** - 引擎和插件系统在前后端通用，代码零重复
**单文件导出** - 使用vite-plugin-singlefile生成自包含HTML
**桌面便携** - packager自动打包含Node.js便携版的桌面应用

## 数据流

```
编辑器：用户操作 → React State → 手动保存 → 后端文件系统
导出：  Story JSON → HTMLExporter → 单文件HTML（内联CSS/JS/图片）
播放器：加载Story → 插件过滤 → CoreEngine → 渲染UI
```

