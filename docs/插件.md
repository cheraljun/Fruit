# 插件系统

## 架构（v3.2+ 完全动态）

**零硬编码** - 所有插件通过钩子动态注册，核心代码无插件特定逻辑

**跨端共享** - PluginSystem 在前后端通用，插件代码零重复

**完全显式** - 新增插件只需在分类 `index.ts` 中添加一行实例化代码

## 插件注册流程

```typescript
// 1. 实现插件（显式定义钩子）
class MyPlugin extends PluginBase {
  hooks = {
    'plugin:get-variables': (vars) => [...vars, ...MY_VARIABLES],
    'plugin:get-docs': (docs) => ({ ...docs, [id]: getDocs() }),
    'blockly:register-blocks': (blocks) => [...blocks, ...myBlocks]
  };
}

// 2. 注册插件（唯一需要修改的位置）
export function createGameModPlugins() {
  return [new TimeSystemPlugin(), new MyPlugin()];
}

// 3. 系统自动收集
const vars = pluginSystem.trigger('plugin:get-variables', []);
const docs = pluginSystem.trigger('plugin:get-docs', {});
```

## 核心钩子

**插件资源注册**（v3.2新增）
- plugin:get-variables - 注册变量定义
- plugin:get-docs - 注册使用文档

**Blockly扩展**
- blockly:register-blocks - 注册积木块定义
- blockly:register-generators - 注册代码生成器
- blockly:register-toolbox-categories - 注册工具箱类别

**生命周期**
- engine:init / node:enter / choice:select / content:render 等50+钩子

