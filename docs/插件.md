# 插件系统

## 钩子机制

**数据转换钩子（同步）**
- `content:process` - 模板替换（`{{$vars.xxx}}`）
- `choice:filter` - 根据条件过滤选项
- `content:render` - 渲染Markdown等内容

**事件钩子（异步通知）**
- `node:before-enter` / `node:after-enter`
- `node:before-leave`
- `choice:before-select` / `choice:select`
- `data:save` / `data:load`

**Blockly扩展钩子**
- `blockly:register-blocks` - 注册积木块定义
- `blockly:register-generators` - 注册代码生成器
- `blockly:register-toolbox-categories` - 注册工具箱分类

**插件数据钩子**
- `plugin:get-variables` - 提供预定义变量
- `plugin:get-docs` - 提供使用文档

钩子按注册顺序执行，数据在钩子间流转。

## 生命周期

**注册流程**
1. `register`：注册插件元数据，检查依赖和冲突
2. `install`：调用插件的install方法，注册钩子
3. `enable`：启用插件（如果默认禁用）

**互斥规则**
- `theme` 和 `enhance` 类型同时只能启用一个
- `conflicts` 声明的插件会自动禁用

## 开发插件

继承`PluginBase`，实现metadata和hooks：

```typescript
class MyPlugin extends PluginBase {
  metadata = { 
    id: 'my.plugin',
    name: '我的插件',
    category: 'tool',
    requires: ['basicmod.runtime']
  };
  
  hooks = {
    'content:process': (data, context) => {
      // 处理内容
      return data;
    }
  };
}
```


