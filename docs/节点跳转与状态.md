# 节点跳转与状态

## 节点流

**一切都是节点跳转** - 状态存储在节点和全局变量中，跳转只改变位置

## 两种跳转

**makeChoice（剧情选择）**
- 依赖edge连线，通过选项ID查找目标
- 触发choice事件（可用于统计、成就、剧情分支）
- 语义：玩家做出决策

**jumpToNode（空间探索）**
- 直接指定目标节点ID，不依赖edge
- 不触发choice事件
- 语义：空间移动、地图导航

**本质相同** - 都是改变currentNodeId，触发节点进入钩子，重新渲染UI

## 状态管理

**全局变量** - RuntimePlugin的vars对象，跨节点持久化  
**历史记录** - CoreEngine的history数组，支持回退  
**当前位置** - currentNodeId，无论怎么跳转都正确更新

状态独立于跳转方式，由节点流统一管理

## 插件注册

**自动注册** - PlayerCore启动时调用createBuiltinPlugins()自动注册所有内置插件  
**容错机制** - try-catch包裹每个插件注册，单个失败不影响其他  
**防重复** - pluginsInitialized标志确保只初始化一次  
**依赖检查** - 自动验证requires字段，缺少依赖会报错

