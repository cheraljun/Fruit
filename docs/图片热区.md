# 图片热区系统

## 核心原理

热区是图片上的可点击矩形区域，点击后跳转到指定节点。

## 数据结构

```typescript
interface Hotspot {
  id: string;
  label: string;          // 热区名称
  targetNodeId: string;   // 目标节点ID
  rect: {                 // 矩形区域
    x: number;            // 相对于图片的X坐标（像素）
    y: number;            // 相对于图片的Y坐标
    width: number;        // 宽度
    height: number;       // 高度
  };
}
```

## 存储位置

保存在节点的 `pluginData` 中：
```typescript
node.data.pluginData = {
  'image-hotspots': [
    { id: '1', label: '左门', targetNodeId: 'node_2', rect: {...} },
    { id: '2', label: '右门', targetNodeId: 'node_3', rect: {...} }
  ]
};
```

## 编辑流程

**在NodeVisualPanel中绘制**
1. 用户点击"编辑热区"按钮
2. 进入热区编辑模式（覆盖层+工具）
3. 鼠标拖拽绘制矩形
4. 填写热区名称和目标节点
5. 保存到 `pluginData['image-hotspots']`

## 播放器渲染

**VisualNovelPlayer中**
```typescript
// 渲染热区为可点击区域
{hotspots.map(hotspot => (
  <div
    key={hotspot.id}
    onClick={() => handleHotspotClick(hotspot.targetNodeId)}
    style={{
      position: 'absolute',
      left: hotspot.rect.x,
      top: hotspot.rect.y,
      width: hotspot.rect.width,
      height: hotspot.rect.height,
      cursor: 'pointer',
      border: '2px solid rgba(255, 255, 255, 0.3)'
    }}
  />
))}
```

## 跳转机制

**直接跳转 vs 选项跳转**
- 选项跳转：通过 edge 连接（`engine.makeChoice`）
- 热区跳转：直接指定节点ID（`engine.jumpToNode`）

**jumpToNode 实现**
```typescript
jumpToNode(targetNodeId: string): CurrentNode {
  // 不检查edge，直接跳转
  this.currentNodeId = targetNodeId;
  this.history.push(this.currentNodeId);
  return this.getCurrentNode();
}
```

## 与选项的区别

| 特性 | 选项（Choice） | 热区（Hotspot） |
|------|----------------|-----------------|
| 连接方式 | 通过Edge连接 | 直接指定节点ID |
| 显示位置 | 底部选项栏 | 图片上覆盖层 |
| 条件判断 | 支持（Blockly脚本） | 不支持 |
| 适用场景 | 对话、剧情分支 | 空间探索、地图导航 |

## 应用场景

- Backrooms探索（点击门、通风口）
- 废土地图（点击不同地点）
- 房间调查（点击桌子、柜子、门）
- 迷宫导航（点击方向）


