# 数据存储

## 存储策略

**手动保存** - 用户明确触发，编辑只改内存
**原子写入** - AtomicFileWriter先写临时文件，rename保证一致性
**JSON格式** - Story对象直接序列化，不用数据库

## 双模式存储

**登录用户（backend/userdata）**
```
userdata/用户名/
  .author.json       认证信息（密码hash、邮箱）
  drafts/*.json      草稿区（可编辑、手动保存）
  published/*.json   发布区（只读快照）
  pictures/*.webp    图片（hash去重）
```

**游客模式（sessionStorage）**
- GuestStorage.ts封装，关闭浏览器即清空
- 与API层接口一致，切换无缝

## 图片处理

imageProcessor压缩为WebP，存储相对路径
导出时HTMLExporter转base64内联到单文件HTML

