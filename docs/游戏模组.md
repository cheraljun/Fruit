# 游戏模组

## 定义

GameMod 是 category 为 'gamemod' 的插件，通过钩子动态注册变量、积木块和文档

## 钩子实现（v3.2+ 完全动态）

模组通过6个钩子向系统注册资源，无需修改核心代码：

1. **plugin:get-variables** - 注册变量定义
2. **plugin:get-docs** - 注册使用文档
3. **blockly:register-blocks** - 注册积木块定义
4. **blockly:register-generators** - 注册代码生成器
5. **blockly:register-toolbox-categories** - 注册工具箱类别
6. **onInstall()** - 注册Runtime函数

## 完整示例

```typescript
// TimeSystemPlugin.ts
export class TimeSystemPlugin extends PluginBase {
  hooks = {
    'plugin:get-variables': (vars) => [...vars, ...TIME_SYSTEM_VARIABLES],
    'plugin:get-docs': (docs) => ({ ...docs, [this.metadata.id]: getDocs() }),
    'blockly:register-blocks': (blocks) => [...blocks, ...timeBlocks],
    'blockly:register-generators': (gens) => ({ ...gens, ...timeGens }),
    'blockly:register-toolbox-categories': (cats) => [...cats, timeCat]
  };
  protected async onInstall() {
    this.runtimePlugin.registerFunction('addTime', (m) => {...});
  }
}
```

## 新增模组步骤

1. 创建 `shared/plugins/gamemods/my-mod/`
2. 实现6个钩子（变量、文档、3个Blockly、onInstall）
3. 在 `gamemods/index.ts` 添加 `new MyModPlugin()`
4. 完成！ScriptHelper、Blockly工具箱自动更新
