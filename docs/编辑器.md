# 编辑器

## ReactFlow集成

**节点流编辑** - 拖拽节点，连线表示选项跳转
**sourceHandle机制** - 每个选项对应一个Handle，精准连线
**useStoryEditor** - 集中管理节点/边/变量/元信息，快照撤销

## Blockly可视化编程

**独立浮窗** - DraggableWindow组件，不遮挡节点编辑
**变量注入** - 从VariableManager单向注入，Blockly不可创建变量
**代码生成重写** - blocklyInit.ts重写生成器，输出`vars['变量名']`格式
**执行器** - BlocklyExecutor解析生成的代码，沙箱执行

## 图片处理

**imageProcessor** - WebP压缩，最大1MB，保持宽高比  
**背景图** - NodeEditPanel上传，保存相对路径，支持场景名称  
**角色立绘** - 左/中/右三位置，视觉小说模式专用

## 热区编辑器

**HotspotEditor** - 可视化绘制热区，支持拖拽创建矩形区域  
**数据存储** - 热区保存在`node.data.pluginData["image-hotspots"]`  
**目标选择** - 下拉列表选择跳转目标节点  
**实时预览** - 蓝色半透明矩形显示热区位置和标签

## 导出功能

HTMLExporter加载预构建播放器模板，注入Story JSON和样式CSS，触发下载

