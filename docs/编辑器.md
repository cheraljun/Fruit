# 编辑器

## ReactFlow集成

**节点流编辑** - 拖拽节点，连线表示选项跳转
**sourceHandle机制** - 每个选项对应一个Handle，精准连线
**useStoryEditor** - 集中管理节点/边/变量/元信息，快照撤销

## Blockly可视化编程（v3.2动态）

**工具箱** - 插件通过`blockly:register-toolbox-categories`动态注册类别
**变量注入** - 从VariableManager单向注入，Blockly工作区只使用不创建
**代码生成** - blocklyInit.ts重写生成器，输出`vars['变量名']`格式
**执行器** - BlocklyExecutor沙箱执行，注入vars对象和fns函数

## 图片处理

**imageProcessor** - WebP压缩，最大1MB，保持宽高比  
**背景图** - NodeEditPanel上传，保存相对路径，支持场景名称  
**角色立绘** - 左/中/右三位置，视觉小说模式专用

## 热区编辑器

**HotspotEditor** - 可视化绘制热区，支持拖拽创建矩形区域  
**数据存储** - 热区保存在`node.data.pluginData["image-hotspots"]`  
**目标选择** - 下拉列表选择跳转目标节点  
**实时预览** - 蓝色半透明矩形显示热区位置和标签

## 标签分组

**标签字段** - 每个节点的`node.data.tags: string[]`存储标签列表  
**标签筛选** - 侧边栏下拉选择标签，画布只显示匹配的节点  
**内置标签** - "全部"显示所有节点，"未分组"显示无标签节点  
**搜索支持** - 节点搜索功能支持按标签名称搜索

**典型用途**：
- 按章节组织节点（第一章、第二章）
- 按故事线分类（主线、支线、隐藏）
- 按功能分组（战斗、对话、探索）

## 导出功能

HTMLExporter加载预构建播放器模板，注入Story JSON和样式CSS，触发下载

