# 多结局分支

## 设计理念

**结局不是单点,而是从Day 20开始的分支路径**

玩家在后期遇到关键选择,决定走向哪个结局。

---

## 结局树状图

```
Day 1-20: 共同体验（探索、生存、学习）
    ↓
Day 20: 关键分岔点
    ├─ 追求逃离 → Level ∞路线 → 逃离结局
    ├─ 接受定居 → Level 11路线 → 定居结局
    ├─ 冒险探索 → Level 5路线 → The Beast结局（死亡）
    ├─ 好奇Level Fun → 派对路线 → 转化结局
    ├─ 资源失败 → 饿死/理智崩溃结局
    └─ 隐藏探索 → 真相路线 → 隐藏结局
```

---

## 关键分岔节点

### Level4_Day20_Choice

```markdown
Day 20

你在Level 4的沙发上，思考未来。

你已经在后室生存了20天。

【现状】
- 探索了[X]个层级
- 杏仁水储备充足
- 理智尚可
- 掌握了基本生存技巧

【问题】
你接下来要做什么？

【选项】（重大决策）
→ 寻找逃离的方法（逃离路线）
→ 前往Level 11寻找定居点（定居路线）
→ 继续冒险探索（冒险路线）
→ 就在Level 4长期生存（保守路线）
```

---

## 路线1：逃离路线

### Level4_EscapeRoute

```markdown
你决定寻找逃离的方法。

【文本】
你在Level 4的白板上写下：
"探索目标：找到出口。"

你需要：
1. 提升Noclip技巧到最高等级
2. 探索更多层级寻找线索
3. 找到传说中的"出口"

【任务开启】
- 前往Level 5收集情报
- 阅读其他幸存者的留言
- 寻找"出口"的传说

【变量设置】
pursuing_escape = true
```

### 逃离路线的任务链

```
Level4_EscapeRoute
  ↓
Level5_BeastClue（在Level 5发现The Beast的日记）
  ↓
Level11_ExitRumor（Level 11社区听说出口传闻）
  ↓
LevelInfinity_Discovery（发现Level ∞入口）
  ↓
Ending_Escape（逃离结局）
```

---

## 路线2：定居路线

### Level4_SettlementRoute

```markdown
你决定不再寻找出口。

【文本】
也许...后室就是新家。

Frontrooms有什么？
工作压力，社交焦虑，无尽的琐事。

这里有什么？
Level 4的杏仁水。
Level 11的都市夜景。
无尽的时间。

你接受了这个现实。

【任务开启】
- 前往Level 11寻找定居点
- 建立永久基地
- 收集长期物资

【变量设置】
gave_up_escape = true
pursuing_settlement = true
```

### 定居路线的任务链

```
Level4_SettlementRoute
  ↓
Level11_CityArrival（到达Level 11）
  ↓
Level11_ApartmentFind（找到公寓）
  ↓
Level11_Settlement_Day30（Day 30定居）
  ↓
Ending_Settlement（定居结局）
```

---

## 路线3：冒险路线（高风险）

### Level4_AdventureRoute

```markdown
你决定继续探索。

【文本】
Level 5的物资很诱人。
虽然危险,但你需要资源。

【警告】
Level 5有The Beast。
理智消耗极高（-15/小时）。

【选项】
→ 前往Level 5冒险
→ 重新考虑
```

### 冒险路线的高风险高回报

```
Level4_AdventureRoute
  ↓
Level5_Exploration（探索Level 5）
  ├─ 成功: 获得大量物资 → 继续其他路线
  └─ 失败: 遭遇The Beast → Ending_Death_Beast
```

---

## 路线4：Level Fun陷阱

### Level2_FunTemptation

```markdown
【如果玩家多次访问Level Fun入口】

那扇彩色的门...

你已经第3次路过这里了。

【内心挣扎】
警告说很危险。
但你好奇...里面到底是什么？

【选项】
→ 推开门进入（致命）
→ 继续无视
```

### 如果进入

```
Level2_FunTemptation
  ↓
LevelFun_Entrance（进入派对空间）
  ├─ 立即逃脱（需高Noclip）→ 回到主路线
  └─ 被抓住 → Infection路线 → Ending_Transformation
```

---

## 路线交叉设计

### 逃离路线可以转向定居

**LevelInfinity_Choice**

```markdown
Level ∞

你找到了出口。

门后是Frontrooms。

但这时,你犹豫了。

【文本】
你想起Level 4的杏仁水。
Level 11的霓虹灯。
你的Blub Cat。

Frontrooms...真的是你想回去的地方吗？

【选择】
→ 推开门（逃离结局）
→ 转身离开（转向定居路线）
```

### 定居路线可以发现隐藏结局

**Level11_Day100**

```markdown
Day 100

你已经在Level 11生活了3个月。

【文本】
你在整理公寓时,发现一本旧日记。

最后一页写着坐标：
"Level ∞的入口在Level 11地铁第13号线。"

【选择】
→ 前去调查（通往真相结局）
→ 无视（继续定居）
```

---

## 关键变量影响结局

### Karma Score影响

```javascript
// 在结局节点检查

// 逃离结局
if (vars['karma_score'] >= 3) {
  文本 = "你帮助了很多人。你值得回家。"
} else {
  文本 = "你独自逃离。留下的人呢？"
}

// 定居结局
if (vars['karma_score'] >= 3) {
  文本 = "Level 11社区欢迎你。你是他们的一员。"
} else {
  文本 = "你独自定居。孤独，但自由。"
}
```

### 探索进度影响

```javascript
// 探索越多,逃离结局越容易触发
if (vars['explored_levels'] >= 8) {
  // 解锁Level ∞入口
}

// 探索太少,只能定居
if (vars['explored_levels'] < 5) {
  // 无法触发逃离路线
}
```

---

## 假结局设计

### Level11_FakeEnding

```markdown
Day 30

Level 11

你在公寓里醒来。

窗外霓虹灯闪烁。

你已经完全适应了这里。

【文本】
这就是你的结局吗？
在Level 11定居？

【选项】
→ 接受（定居结局）
→ "不,我还想探索"（继续游戏）
```

**如果选"继续探索"**:

```markdown
你走出公寓。

Level 11还有很多未知区域。

也许...还有更多秘密等待发现。

【解锁】
- 继续探索Level 11
- 可能发现Level ∞入口
- 通往隐藏结局
```

---

## 实现建议

### 结局标志变量

```javascript
// 路线标志
vars['pursuing_escape'] = false
vars['pursuing_settlement'] = false
vars['in_fun_route'] = false

// 结局触发
vars['escape_available'] = false
vars['settlement_available'] = false
```

### 结局入口节点

每个结局有专门的"入口节点",集中判断条件:

```
Ending_Escape_Gate
  ├─ 检查条件
  ├─ 如果满足 → Ending_Escape
  └─ 如果不满足 → 提示缺少什么
```

### 多结局成就系统

```yaml
成就:
  - "逃离成功": 达成逃离结局
  - "定居者": 达成定居结局
  - "好奇心害死猫": 进入Level Fun
  - "真相探寻者": 达成隐藏结局
  - "全结局": 解锁所有8个结局
```

