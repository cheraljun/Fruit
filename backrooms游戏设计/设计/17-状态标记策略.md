# 状态标记策略

## 设计理念

**用简单的true/false和state字符串,不用精确数值**

符合mo编辑器的能力,也符合叙事驱动的游戏定位。

---

## 变量分类

### 1. 布尔标记（true/false）

**用途**: 记录是否发生某事

```javascript
// 发现类
vars['found_level4'] = true
vars['found_level11'] = true
vars['discovered_secret_room'] = true

// 遭遇类
vars['has_seen_smiler'] = true
vars['has_seen_hound'] = true
vars['escaped_level_fun'] = true

// 知识类
vars['knows_smiler_weakness'] = true
vars['knows_hound_stare'] = true
vars['knows_fun_warning'] = true

// 物品类
vars['has_rope'] = true
vars['has_flashlight'] = true
vars['has_blub_cat'] = true

// 行为类
vars['helped_survivor'] = true
vars['refused_help'] = true
vars['left_memorial'] = true
```

---

### 2. 状态字符串（state）

**用途**: 表示当前状态

```javascript
// 理智状态
vars['sanity_state'] = 'stable'   // 稳定
vars['sanity_state'] = 'anxious'  // 焦虑
vars['sanity_state'] = 'unstable' // 不稳定
vars['sanity_state'] = 'breaking' // 崩溃边缘

// 杏仁水状态
vars['almond_water_state'] = 'sufficient'  // 充足(5+瓶)
vars['almond_water_state'] = 'low'         // 紧张(1-4瓶)
vars['almond_water_state'] = 'critical'    // 危急(0瓶)

// 生命状态
vars['health_state'] = 'healthy'  // 健康
vars['health_state'] = 'injured'  // 受伤
vars['health_state'] = 'critical' // 危急

// 体力状态
vars['stamina_state'] = 'full'      // 充沛
vars['stamina_state'] = 'tired'     // 疲惫
vars['stamina_state'] = 'exhausted' // 精疲力尽
```

---

### 3. 计数变量（number）

**用途**: 简单计数,不做复杂计算

```javascript
// 访问次数
vars['level4_visit_count'] = 3

// 探索进度
vars['explored_levels'] = 5

// 生存天数
vars['days_survived'] = 20

// 遭遇次数
vars['smiler_encounter_count'] = 2

// 道德分数（简单累加）
vars['karma_score'] = 3  // -5到+5的范围
```

---

## 状态转换规则

### 理智状态转换

```javascript
// 节点中的Blockly脚本

// 消耗理智
if (vars['sanity_state'] === 'stable') {
  vars['sanity_state'] = 'anxious'
}

// 恢复理智（喝杏仁水）
if (vars['sanity_state'] === 'anxious') {
  vars['sanity_state'] = 'stable'
}

// 急剧下降（遭遇实体）
if (vars['sanity_state'] === 'stable') {
  vars['sanity_state'] = 'unstable'  // 跳级下降
}
```

### 杏仁水状态转换

```javascript
// 使用杏仁水
if (vars['almond_water_state'] === 'sufficient') {
  vars['almond_water_state'] = 'low'
}

// 补充杏仁水（Level 4）
vars['almond_water_state'] = 'sufficient'
```

---

## 文本驱动展示

### 不显示数值,用文字描述

**Level0_Status**

```markdown
【当前状态】

【理智】
【如果sanity_state='stable'】
你的精神状态不错。思维清晰。

【如果sanity_state='anxious'】
你感到不安。墙纸的图案开始让你头晕。

【如果sanity_state='unstable'】
你看到幻觉。走廊在扭曲。
你知道那不是真的...对吗？

【如果sanity_state='breaking'】
现实和幻觉无法区分。
你听到声音。看到影子。
它们都在笑你。

---

【杏仁水】
【如果almond_water_state='sufficient'】
背包里还有足够的杏仁水。你感到安心。

【如果almond_water_state='low'】
杏仁水不多了。你需要尽快补给。

【如果almond_water_state='critical'】
杏仁水用完了。
理智在崩溃边缘。
你必须找到Level 4。
```

---

## 条件判断模板

### Blockly判断示例

**判断是否显示某个选项**:

```javascript
// 只有有绳索时才显示"安全通过"选项
if (vars['has_rope']) {
  // 显示选项A
} else {
  // 隐藏选项A
}
```

**判断理智状态影响文本**:

```javascript
if (vars['sanity_state'] === 'breaking') {
  文本 = "你看到墙纸在蠕动..."
} else if (vars['sanity_state'] === 'unstable') {
  文本 = "墙纸的图案让你头晕。"
} else {
  文本 = "黄色的墙纸延伸到视野尽头。"
}
```

**判断杏仁水状态影响选项**:

```javascript
if (vars['almond_water_state'] === 'critical') {
  // 强制前往Level 4
  自动跳转 = 'Level4_Emergency'
}
```

---

## 实现案例

### Level1_ResourceCheck

```markdown
你在Level 1的仓库中。

【检查状态】

【Blockly脚本】
if (vars['almond_water_state'] === 'low') {
  显示警告文本
}

【文本】
【如果almond_water_state='low'】
⚠️ 警告：杏仁水不足！

你只剩下几瓶杏仁水了。
Level 4在北侧出口。

【选项】
→ 立即前往Level 4补给（推荐）
→ 继续探索（冒险）
```

---

### Level5_BeastEncounter

```markdown
你在Level 5遭遇The Beast。

【理智暴跌】

【Blockly脚本】
if (vars['sanity_state'] === 'stable') {
  vars['sanity_state'] = 'unstable'  // 跳级
} else if (vars['sanity_state'] === 'unstable') {
  vars['sanity_state'] = 'breaking'
}

【文本】
【如果sanity_state='breaking'】
你的理智在崩溃边缘。

眼前的景象开始扭曲。
The Beast的形态在变化。
你分不清现实和幻觉。

【风险】
如果理智继续下降，你可能精神崩溃！

【选择】
→ 使用杏仁水（如果有）
→ 尝试逃跑（困难）
```

---

## 避免的做法

### ❌ 不要精确数值

```javascript
// 不好
vars['sanity'] = 73
vars['health'] = 45
vars['almond_water_count'] = 5

// 玩家看到："理智73/100"
// 破坏沉浸感，变成数值游戏
```

### ❌ 不要复杂计算

```javascript
// 不好
vars['sanity'] = vars['sanity'] - (vars['time_in_level0'] * 0.5)

// Blockly每个工作区独立，不适合持续计算
```

### ❌ 不要UI显示数值

```
// 不好
界面上显示：
HP: 45/100
Sanity: 73/100
Stamina: 60/100

// 应该用文字描述代替
```

---

## 推荐的做法

### ✓ 用状态标记

```javascript
vars['sanity_state'] = 'anxious'
```

### ✓ 用文字描述

```markdown
你感到不安。墙纸的图案开始让你头晕。
```

### ✓ 用简单判断

```javascript
if (vars['sanity_state'] === 'breaking') {
  // 触发危险事件
}
```

### ✓ 用叙事驱动

```markdown
不是"理智-20"，而是：

"你看到了The Beast。
蓝色章鱼头。紫色眼睛。西装革履。

你的理智在崩溃。"
```

---

## 变量命名规范

### 推荐格式

```javascript
// 布尔变量：has_/is_/knows_
vars['has_rope'] = true
vars['is_infected'] = true
vars['knows_weakness'] = true

// 状态变量：_state后缀
vars['sanity_state'] = 'anxious'
vars['health_state'] = 'injured'

// 计数变量：_count后缀
vars['visit_count'] = 3
vars['encounter_count'] = 2

// 分数变量：_score后缀
vars['karma_score'] = 3
```

### 避免的命名

```javascript
// 不好
vars['s'] = 73  // 不清楚是什么
vars['temp'] = true  // 临时变量应避免
vars['data1'] = 'stable'  // 无意义的名字
```

---

## 总结

**核心原则**：
1. 用状态标记而非精确数值
2. 用文字描述而非UI数值
3. 用简单判断而非复杂计算
4. 用叙事驱动而非机制驱动

**符合**：
- mo编辑器的Blockly能力
- 文字互动小说的定位
- Backrooms的氛围恐怖风格

