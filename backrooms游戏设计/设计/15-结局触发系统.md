# 结局触发系统

## 设计理念

**用变量累积判断结局，不是单一选择**

玩家整个游戏过程的多个选择，最终汇聚成结局。

---

## 结局列表

### 成功结局
1. **逃离后室** - 找到出口回到Frontrooms
2. **Level 11定居** - 在城市建立新生活

### 失败结局
3. **死于实体** - 被Hound/Smiler/The Beast杀死
4. **高空坠落** - Drop Maze失败
5. **饿死渴死** - 资源耗尽
6. **精神崩溃** - 理智归零

### 转化结局
7. **派对转化** - 成为Partygoer
8. **Jerry信徒** - 被Jerry控制

---

## 判定变量设计

### 探索进度变量

```javascript
vars['explored_levels'] = 0  // 探索的层级数
vars['days_survived'] = 0    // 生存天数
vars['found_level4'] = false
vars['found_level11'] = false
```

### 道德分数变量

```javascript
vars['karma_score'] = 0

// 好行为
helped_survivor → karma_score += 1
left_memorial → karma_score += 1
warned_others → karma_score += 1

// 坏行为
refused_help → karma_score -= 1
took_all_supplies → karma_score -= 1
```

### 技能变量

```javascript
vars['noclip_mastery'] = false  // 是否掌握高级Noclip
vars['knows_survival'] = false  // 是否学会生存技巧
```

---

## 结局1：逃离后室

### 触发条件

```javascript
// 必须同时满足
条件1: vars['explored_levels'] >= 5
条件2: vars['noclip_mastery'] === true
条件3: vars['days_survived'] >= 30
条件4: vars['found_exit_clue'] === true
```

### 结局节点

**Ending_Escape**

```markdown
你站在一扇普通的门前。

但你知道，这就是出口。

门后的光线看起来...不同。更真实。

你推开门——

---

你跌倒在人行道上。

阳光刺眼。车流。人群。

Frontrooms。

你回来了。

**Game Clear: Escape**

Days Survived: [天数]
Levels Explored: [层级数]
Karma Score: [分数]

"你是极少数成功逃离的人之一。"

【后续文本】
你站起来，拍掉身上的灰尘。

路人奇怪地看着你（你穿着破旧，满脸疲惫）。

你...自由了。

但你会记得那些黄色走廊。
你会记得Level 4的杏仁水。
你会记得孤独。

Backrooms永远是你的一部分。
```

---

## 结局2：Level 11定居

### 触发条件

```javascript
条件1: vars['found_level11'] === true
条件2: vars['days_survived'] >= 20
条件3: vars['gave_up_escape'] === true  // 主动放弃逃离
```

### 结局节点

**Ending_Settlement**

```markdown
Day 30

Level 11 - 你的公寓

你坐在窗边，看着霓虹灯闪烁的街道。

Facelings在街上行走，就像正常人一样。
你的Blub Cat在沙发上打呼噜。

背包里有20瓶杏仁水。
冰箱里有食物（从商店拿的）。

【文本】
你已经一周没想过"逃离"这个词了。

Frontrooms有什么？
加班。账单。社交焦虑。

这里有什么？
无尽的时间。安静。自由。

你接受了。

这里是你的新家。

**Game End: Settlement**

Days Survived: [天数]
Ending: Level 11 Resident

"你选择了在后室中建立新生活。"
```

---

## 结局3-6：死亡结局

### 通用触发

```javascript
// 任何导致health=0或sanity=0的节点
if (vars['health'] <= 0 || vars['sanity'] <= 0) {
  跳转到对应死亡结局
}
```

### 死于实体（示例）

**Ending_Death_Hound**

```markdown
Hound的爪子划过你的胸部。

你倒在地上。

视线模糊。

最后你看到的是荧光灯。

嗡————嗡————嗡————

然后是黑暗。

**Game Over: Death by Hound**

Days Survived: [天数]
Levels Explored: [层级数]

"你成为了Level 1的又一具遗骸。"
```

---

## 结局7：派对转化

### 触发条件

```javascript
条件: vars['partygoer_infected'] === true
     && vars['infection_day'] >= 7
     && vars['cure_attempted'] === false
```

### 结局节点

**Ending_Transformation**

```markdown
你站在Level Fun的门口。

皮肤完全是黄色。
手臂变形。
脸上永恒的笑容。

"来参加派对吧！=)"

这不再是你的声音。

你是它们的一员了。

**Game Over: Transformation**

Days Survived: [天数]
Ending: Partygoer

"好奇心最终吞噬了你。"
```

---

## 隐藏结局：真相

### 触发条件（极难）

```javascript
条件1: vars['explored_levels'] >= 10  // 探索大量层级
条件2: vars['found_all_clues'] === true  // 收集所有线索
条件3: vars['reached_level_infinity'] === true  // 到达Level ∞
```

### 结局节点

**Ending_Truth**

```markdown
Level ∞

什么都没有。

纯粹的虚空。

然后，一个声音：

"你找到了。"

【揭示】
"后室不是监狱。
后室是避难所。

Frontrooms正在崩溃。
后室是最后的安全地。

你被选中了。"

【选择】
→ 回到Frontrooms（面对终结）
→ 留在后室（等待）

**Game Clear: The Truth**

"你发现了后室的秘密。"
```

---

## 结局判定流程

### 关键节点：Level11_EndingCheck

```javascript
// 玩家到达Day 30或某个触发点时
// 自动判定结局

// 判定1：是否死亡
if (vars['health'] <= 0) {
  → 对应死亡结局
}

if (vars['sanity'] <= 0) {
  → 精神崩溃结局
}

// 判定2：是否被感染
if (vars['partygoer_infected'] && vars['infection_day'] >= 7) {
  → 派对转化结局
}

// 判定3：是否满足逃离条件
if (vars['explored_levels'] >= 5 
    && vars['noclip_mastery'] 
    && vars['found_exit_clue']) {
  → 显示逃离结局选项
}

// 判定4：是否满足定居条件
if (vars['found_level11'] 
    && vars['days_survived'] >= 20
    && vars['gave_up_escape']) {
  → 定居结局
}

// 默认：继续游戏
```

---

## 实现建议

### 结局解锁提示

**Level4_Library白板**

```markdown
白板上有人写着：

> "据说有8种结局。
> 我达成了'定居'结局。
> 你能找到其他的吗？
> -- Alex, Day 100"

（暗示多结局，鼓励重玩）
```

### 结局统计

**结局界面显示**

```yaml
Game Over / Game Clear

结局: Level 11定居
Days Survived: 35天
Levels Explored: 6个
Karma Score: +3

已解锁结局: 2/8
- ✓ 定居
- ✓ 死于Hound
- ? 逃离
- ? 派对转化
- ...

【选项】
→ 重新开始（保留结局解锁记录）
→ 返回主菜单
```

---

## 多结局的叙事意义

### 不同结局反映不同哲学

```
逃离 = "我要回家"（传统）
定居 = "也许这里更好"（反思）
死亡 = "我失败了"（悲剧）
转化 = "我失去了自我"（恐怖）
```

### 鼓励重玩

```
第一次玩：随机达成某个结局
第二次玩：尝试达成其他结局
第三次玩：挑战最难的"逃离"结局
```

玩家会想"我这次能逃离吗？"

